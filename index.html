<html>
<head>
	<meta charset="UTF-8">
	<link rel="stylesheet" href="style.css">
	<script src='script.js'></script>
	<script>
		var law_tables = [];
		window.addEventListener("load", function() {let fileReader = new FileReader();
			const xhr = new XMLHttpRequest();
			xhr.open('get', './index.csv');
			xhr.send();
			xhr.onreadystatechange = function() {
				if( xhr.readyState === 4 && xhr.status === 200) {
					let lines = this.responseText.split('\n');
					let items = lines.map(item => {
						return item.split(',');
					});
					law_tables = items;
				}
			};
		});

		function search(text){
			const search_results = document.getElementById('search_results');
			search_results.innerHTML = "";

			let count = 0;
			if(text.length > 0){
				for(let i = 0; i < law_tables.length; i++){
					let found = false;
					for(let j = 0; j < law_tables[i].length; j++){
						if(law_tables[i][j].indexOf(text) >= 0){
							found = true;
							break;
						}
					}
					if(found){
						const res = document.createElement('div');
						res.className = 'search_result';
						res.innerHTML = (
							"<div class='search_type'>" + law_tables[i][0] + "</div><div class='search_title'><a href='./" + law_tables[i][4] +  ".html'>" + law_tables[i][2] + "</a></div>\n"
						);
						search_results.appendChild(res);
						count += 1;
					}
				}
			}
			const search_result_num = document.getElementById('search_result_num');
			search_result_num.innerText = String(count) + " 件";
		}
	</script>
</head>
<body>
	<div class="pages">
		<div class="header">
			<a href="./" class="logo"></a>
			<input type="text" placeholder="Search Text" value="" class="search_box" id="searchTextBox" onInput="search(this.value)"/>
		</div>
		<div class="main">
			<div class="main_body">
				<div class="search_list">
					<div class="search_result_num" id="search_result_num">こちらから法令を検索できます　↑</div>
					<div class="search_results" id="search_results">						
					</div>
				</div>
			</div>
		</div>
		<div class="footer"></div>
	</div>
</body>
</html>